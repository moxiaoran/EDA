---
title: "Civil Forfeiture"
author: "Yifei Liu"
date: "11/19/2018"
output: html_document
---


```{r}
library(tidyverse)
library(lubridate)
theme_set(theme_light())
library(scales)


```



```{r}
civil_forfeiture <- fread("/Users/yifeiliu/Documents/R/data/EDA/ES_data.csv")

civil_us <- civil_forfeiture %>%
  tbl_df() %>%
  select(SZ_DT, CTRY_CD, ASSET_THRLD_FLG, ASSET_TYP, ASSET_VAL, QK_RLS_IND, STAT_PRIM,SZ_AGCY_CD, SZ_METH, SZ_ST, SZD_FRM_BUSFLG, SHR_CONTRIB_HRS, SHR_IA_EXP, SHR_REQ_PCT, SHR_REQ_TYP, SHR_TYP, SHR_USMS_EXP, OAG_NM) %>% 
  filter(CTRY_CD == "USA",
         SHR_TYP %in% c("A", "J")) %>%
  select(- CTRY_CD) %>% 
  mutate(SZ_DT = as.factor(as.character(SZ_DT)),
         SZ_DT = as.POSIXct(SZ_DT, format = "%Y%m%d"),
         SZ_DT = as.Date(SZ_DT))
  
civil_us


  
```

### Basic EDA

- how many case we have per year
- which state confiscate most money
- what asset type been most common ben confiscate
- how many money been confiscate every year. 


```{r}

civil_us_year <- civil_us %>%
  mutate(year = year(SZ_DT))

# how many case per year
civil_us_year %>%
  count(year) %>%
  ggplot(aes(year, n)) +
  geom_col() +
  labs(x = "",
       y = "# of case",
       title = "Annual Forfeiture Case",
       caption = "Source: Instutute for Justice")

# how many money per year
civil_us_year %>%
  group_by(year) %>%
  summarize(forf_total = sum(ASSET_VAL)) %>%
  filter(!is.na(year)) %>%
  ggplot(aes(year, forf_total)) +
  geom_col() +
  scale_y_continuous(labels = dollar_format(scale = 0.000001, prefix = "B$")) +
  labs(x = "",
       y = "", 
       title = "Total Forfeiture amount",
       caption = "Source: Instutute for Justice")

# 



civil_us_year %>%
  group_by(SZ_ST) %>%
  summarize(for_total = sum(ASSET_VAL, na.rm = T)) %>%
  arrange(desc(for_total))

civil_us_year %>%
  count(QK_RLS_IND) %>%
  mutate(QK_RLS_IND = fct_reorder(QK_RLS_IND, n)) %>%
  head(15) %>%
  ggplot(aes(QK_RLS_IND, n, color = QK_RLS_IND)) +
  coord_flip() +
  theme(legend.position = "none")

# most cause asset will not be released

civil_us_year %>%
  group_by(ASSET_TYP) %>%
  summarize(asset_total = sum(ASSET_VAL)) %>%
  arrange(desc(asset_total))
  

# most common asset been taken is cash

civil_us_year %>%
  group_by(year, SHR_TYP) %>%
  summarize(value = sum(ASSET_VAL)) %>%
  ggplot(aes(year, value, fill = SHR_TYP)) +
  scale_y_continuous(labels = dollar_format(scale = 0.000001, prefix = "B$")) +
  geom_col() +
  labs(x = "",
       y = "",
       title = "DOJ ")



```

Base on these basic visualization we can draw some conclusion
1. Both the case and total value amount are on a increase trend
2. State like CA, NY, FL on top of the list. 
3. most asset will not been release immediately
4. most common asset is cash, value over  30 billion

















what data I need:

SZ_DT, the date that asset been seized
asset_thrld_flg, whether the min value requried to be forfeited
asset_typ, asset type
asset_val, asset value
ctry_cd, filter out other country only leave USA
PROC_DIST, judicial distrcit responsible for processing the case
QK_RLS_IND, asset going to be quick released
STAT_PRIM, a code specil title and sectionof law that describes the legal basis for the seizure
SZ_AGCY_CD, code identify Federal government seizing agencies. 
SZ_METH, code describing by which the asset was seized. 
SZ_ST, the US state where the asset was seized
SZD_FRM_BUSFLG, a yes/no flag indicating if the asset was seized from a plce of business. 
SHR_CONTRIB_HRS, number of hourse expended by teh sate agency in contributing to seize the asset
SHR_IA_EXP, expense incurred by agency that processing seized asset. 
SHR_REQ_PCT, percentage of total asset or net value been received by agency
SHR_REQ_TYP, agency wishes to receive actual item or just cash, C or I
SHR_TYP, join or solely by local agency j or A
SHR_USMS_EXP, expense incurred by US marshaals related to seized asset
OAG_NM, other agency' name 


reference:
https://ij.org/report/policing-for-profit/
